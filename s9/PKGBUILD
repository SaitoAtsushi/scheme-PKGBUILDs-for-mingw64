_realname=s9
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=20250812
pkgrel=1
pkgdesc="A mature, portable, and comprehensible interpreter for R4RS Scheme."
arch=('any')
url="http://t3x.org/s9fes/"
license=('CC0')
depends=()
makedepends=("${MINGW_PACKAGE_PREFIX}-gcc" "coreutils" "${MINGW_PACKAGE_PREFIX}-make")
source=("http://t3x.org/s9fes/s9fes-20250812.tgz"
        "s9-mingw.patch")
sha256sums=('33d8da39e1fd4a3cb4ea918c57b08e69263da0c402fbc1a6946a559d8d0901ad'
            'SKIP')

prepare() {
  cd ${srcdir}/s9
  patch -p1 -i ${srcdir}/s9-mingw.patch
}

build() {
  cd ${srcdir}/s9
  make CC=gcc CFLAGS="-Wall -std=c99 -pedantic -O2 -Wno-stringop-truncation" PREFIX=${MINGW_PREFIX}
}

package() {
  cd ${srcdir}/s9
  make DESTDIR=${pkgdir} PREFIX=${MINGW_PREFIX} install-s9
  make DESTDIR=${pkgdir} PREFIX=${MINGW_PREFIX} install-util
  make DESTDIR=${pkgdir} PREFIX=${MINGW_PREFIX} install-progs
}
